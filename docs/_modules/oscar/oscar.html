

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>oscar.oscar &mdash; Oscar  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Oscar
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Oscar</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">oscar.oscar</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for oscar.oscar</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;A set of classes and functions to read and transform hdf5 files in the NDF </span>
<span class="sd">    file format.</span>

<span class="sd">  (c) Joris Remmers (2021-2023)</span>
<span class="sd">  </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">vtk</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    
<span class="kn">from</span> <span class="nn">.VTKutils</span> <span class="kn">import</span> <span class="n">insertElement</span>

<div class="viewcode-block" id="apply_rainbow_color_map">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.apply_rainbow_color_map">[docs]</a>
<span class="k">def</span> <span class="nf">apply_rainbow_color_map</span><span class="p">(</span><span class="n">mapper</span><span class="p">):</span>

    <span class="n">rng</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetScalarRange</span><span class="p">()</span>

    <span class="n">lookup_table</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkLookupTable</span><span class="p">()</span>
    <span class="n">lookup_table</span><span class="o">.</span><span class="n">SetNumberOfTableValues</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">lookup_table</span><span class="o">.</span><span class="n">Build</span><span class="p">()</span>
    <span class="n">lookup_table</span><span class="o">.</span><span class="n">SetTableRange</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rng</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Set the range of data values</span>
    <span class="n">lookup_table</span><span class="o">.</span><span class="n">SetHueRange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">)</span>  <span class="c1"># Map color hue from blue to red</span>
    <span class="n">mapper</span><span class="o">.</span><span class="n">SetLookupTable</span><span class="p">(</span><span class="n">lookup_table</span><span class="p">)</span></div>

 
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
   
<div class="viewcode-block" id="versionCheck">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.versionCheck">[docs]</a>
<span class="k">def</span> <span class="nf">versionCheck</span><span class="p">(</span> <span class="n">f</span> <span class="p">):</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks if the file is an oscar file</span>
<span class="sd">    &#39;&#39;&#39;</span>
  
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;fileFormat&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;RNDF&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span>
  
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error2&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span></div>

    
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  convertToVTU</span>
<span class="c1">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="convertToVTU">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.convertToVTU">[docs]</a>
<span class="k">def</span> <span class="nf">convertToVTU</span><span class="p">(</span> <span class="n">fileName</span> <span class="p">,</span> <span class="n">cycles</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts the oscar .h5 file to a vtu file. The VTU file is written to the </span>
<span class="sd">    drive as fileName.vtu</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        fileName     the name of the h5 file (string)</span>
<span class="sd">        cycles       a list of cycles that is converted.</span>
<span class="sd">                     If cycles is equal to -1, all cycles</span>
<span class="sd">                     are converted.</span>
<span class="sd">                     </span>
<span class="sd">    Returns:                     </span>
<span class="sd">        --</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">oscarFile</span> <span class="o">=</span> <span class="n">oscar</span><span class="p">(</span> <span class="n">fileName</span> <span class="p">,</span> <span class="n">cycles</span> <span class="p">)</span>
  
    <span class="n">oscarFile</span><span class="o">.</span><span class="n">saveAsVTU</span><span class="p">()</span></div>

  
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  convertToDat</span>
<span class="c1">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="convertToDat">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.convertToDat">[docs]</a>
<span class="k">def</span> <span class="nf">convertToDat</span><span class="p">(</span> <span class="n">fileName</span> <span class="p">,</span> <span class="n">cycles</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">):</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts the oscar .h5 file to a dawn dat file. The dat file is written </span>
<span class="sd">    to the drive as fileName.dat</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        fileName     the name of the h5 file (string)</span>
<span class="sd">        cycles       a list of cycles that is converted.</span>
<span class="sd">                     If cycles is equal to -1, all cycles</span>
<span class="sd">                     are converted.</span>
<span class="sd">                     </span>
<span class="sd">    Returns:                     </span>
<span class="sd">        --</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">oscarFile</span> <span class="o">=</span> <span class="n">oscar</span><span class="p">(</span> <span class="n">fileName</span> <span class="p">,</span> <span class="n">cycles</span> <span class="p">)</span>
  
    <span class="n">oscarFile</span><span class="o">.</span><span class="n">saveAsDat</span><span class="p">()</span></div>

  
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="writePVD">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.writePVD">[docs]</a>
<span class="k">def</span> <span class="nf">writePVD</span><span class="p">(</span> <span class="n">prefix</span> <span class="p">,</span> <span class="n">cycles</span> <span class="p">,</span> <span class="n">nProc</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">):</span>
<span class="w">      </span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">nProc</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;writePVD: number of processros should by 1 or more.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">RunTimeError</span>    
    
    <span class="n">pvdfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;.pvd&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

    <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;VTKFile byte_order=&#39;LittleEndian&#39; &quot;</span><span class="p">)</span>
    <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;type=&#39;Collection&#39; version=&#39;0.1&#39;&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  &lt;Collection&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
      
    <span class="k">for</span> <span class="n">iCyc</span> <span class="ow">in</span> <span class="n">cycles</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nProc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    &lt;DataSet file=&#39;&quot;</span><span class="o">+</span><span class="n">PVDfileName</span><span class="p">(</span> <span class="n">prefix</span> <span class="p">,</span> <span class="n">iCyc</span> <span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39; &quot;</span><span class="p">)</span>
            <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;groups=&#39;&#39; part=&#39;0&#39; timestep=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iCyc</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;/&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iProc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nProc</span><span class="p">):</span>
                <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    &lt;DataSet file=&#39;&quot;</span> <span class="o">+</span> 
                                <span class="n">PVDfileName</span><span class="p">(</span> <span class="n">prefix</span> <span class="p">,</span> <span class="n">iCyc</span> <span class="p">,</span> <span class="n">iProc</span> <span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39; &quot;</span><span class="p">)</span>
                <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;groups=&#39;&#39; part=&#39;0&#39; timestep=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iCyc</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;/&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>         
                     
    <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  &lt;/Collection&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/VTKFile&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
    
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="PVDfileName">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.PVDfileName">[docs]</a>
<span class="k">def</span> <span class="nf">PVDfileName</span><span class="p">(</span> <span class="n">prefix</span> <span class="p">:</span> <span class="nb">str</span> <span class="p">,</span> <span class="n">iCyc</span> <span class="p">:</span><span class="nb">int</span> <span class="p">,</span> <span class="n">iProc</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="n">iProc</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_t&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iCyc</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.vtu&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;_p&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iProc</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_t&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">iCyc</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.vtu&quot;</span>     </div>

            
            
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>


<div class="viewcode-block" id="oscar">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar">[docs]</a>
<span class="k">class</span> <span class="nc">oscar</span><span class="p">():</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A class to read and access data in the HDF file format. sdd</span>
<span class="sd">            </span>
<span class="sd">    Args: </span>
<span class="sd">        </span>
<span class="sd">        fileName(str): filename May be with or without the extension .h5</span>
<span class="sd">        verbose(bool): verbose flag.            </span>
<span class="sd">    &#39;&#39;&#39;</span>  

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">fileName</span> <span class="p">:</span> <span class="nb">str</span> <span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor</span>
<span class="sd">        &#39;&#39;&#39;</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fileName</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">):</span>
            <span class="n">fileName</span> <span class="o">+=</span> <span class="s1">&#39;.h5&#39;</span>
      
        <span class="n">tempPrefix</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">tempPrefix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fileDir</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span> <span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    
        <span class="k">if</span> <span class="s1">&#39;cycleCount&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Single file with </span><span class="si">%d</span><span class="s2"> datasets (cycles)&quot;</span>
                       <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;cycleCount&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s2">&quot;cycle1&quot;</span><span class="p">]</span>      
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s2">&quot;cycle1&quot;</span><span class="p">]</span>
      
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error2&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span>  
      
        <span class="bp">self</span><span class="o">.</span><span class="n">cycleCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;cycleCount&#39;</span><span class="p">]</span>   
        
        <span class="k">if</span> <span class="s1">&#39;elements&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">][</span><span class="s1">&#39;connectivity&#39;</span><span class="p">][:]</span>
            <span class="n">offsets</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">][</span><span class="s1">&#39;offsets&#39;</span><span class="p">][:]</span>
                    
            <span class="bp">self</span><span class="o">.</span><span class="n">elemNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpackElements</span><span class="p">(</span> <span class="n">connectivity</span> <span class="p">,</span> <span class="n">offsets</span> <span class="p">)</span>
            
        <span class="k">if</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>                  

<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Prints the main contents of the file</span>
<span class="sd">        &#39;&#39;&#39;</span>
   
        <span class="k">if</span> <span class="s1">&#39;cycleCount&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  
            <span class="k">return</span> <span class="s2">&quot;Single file with </span><span class="si">%d</span><span class="s2"> datasets (cycles).&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;cycleCount&#39;</span><span class="p">]</span>
      
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.setCycle">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.setCycle">[docs]</a>
    <span class="k">def</span> <span class="nf">setCycle</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">iCyc</span> <span class="p">:</span> <span class="nb">int</span> <span class="p">):</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set the cycle for which the output is read.  </span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">           iCyc:   Cycle ID number.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span> <span class="o">=</span> <span class="n">iCyc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s2">&quot;cycle&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">)]</span>
        
        <span class="k">if</span> <span class="s1">&#39;elements&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">][</span><span class="s1">&#39;connectivity&#39;</span><span class="p">][:]</span>
            <span class="n">offsets</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">][</span><span class="s1">&#39;offsets&#39;</span><span class="p">][:]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">elemNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpackElements</span><span class="p">(</span> <span class="n">connectivity</span> <span class="p">,</span> <span class="n">offsets</span> <span class="p">)</span>            
                        
        <span class="k">if</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]</span>                  

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;opened cycle </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span></div>

    
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  getCoords</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="oscar.getCoords">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getCoords">[docs]</a>
    <span class="k">def</span> <span class="nf">getCoords</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">nodeID</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">):</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">          Gets the coordinates of node(s) nodeID</span>
<span class="sd">      </span>
<span class="sd">          Args:</span>
<span class="sd">            nodeID:   nodeID (list or integrer) according to internal numbering</span>
<span class="sd">                      if omitted, all nodes are printed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
      
        <span class="k">if</span> <span class="n">nodeID</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[</span><span class="n">nodeID</span><span class="p">]</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  getCoords3</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.getCoords3">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getCoords3">[docs]</a>
    <span class="k">def</span> <span class="nf">getCoords3</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
<span class="w">  </span>
<span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      Returns the coordinates always in a 3D format (even if the rank is equal to 2).</span>
<span class="sd">      &#39;&#39;&#39;</span>
              
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
          <span class="n">data</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span>
          <span class="k">return</span> <span class="n">data</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="p">[:]</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  getCycle</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.getCycle">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getCycle">[docs]</a>
    <span class="k">def</span> <span class="nf">getCycle</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">          Returns the current cycle ID</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle</span>  </div>

      
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  getElemNodes</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.getElemNodes">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getElemNodes">[docs]</a>
    <span class="k">def</span> <span class="nf">getElemNodes</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">elemID</span> <span class="p">:</span> <span class="nb">int</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns nodes of element ID</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">    </span>
<span class="sd">            elemID:    elementID number.</span>
<span class="sd">        &#39;&#39;&#39;</span>
<span class="w">   </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if elemID == 0:</span>
<span class="sd">            return self.connectivity[0:self.offsets[elemID]]</span>
<span class="sd">        else:</span>
<span class="sd">            return self.connectivity[self.offsets[elemID-1]:self.offsets[elemID]]  </span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemNodes</span><span class="p">[</span><span class="n">elemID</span><span class="p">]</span>            </div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  getElemNodeCount</span>
<span class="c1">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="oscar.getElemNodeCount">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getElemNodeCount">[docs]</a>
    <span class="k">def</span> <span class="nf">getElemNodeCount</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">elemID</span> <span class="p">:</span> <span class="nb">int</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the number of nodes in this element</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">    </span>
<span class="sd">            elemID:    element ID number. This is an integer.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemNodes</span><span class="p">[</span><span class="n">elemID</span><span class="p">])</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  getElemGroupNames</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="oscar.getElemGroupNames">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getElemGroupNames">[docs]</a>
    <span class="k">def</span> <span class="nf">getElemGroupNames</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns all element group names</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="s1">&#39;elementGroups&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>    
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;elementGroups&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">elif</span> <span class="s1">&#39;elementGroups&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;elementGroups&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  getElemGroup</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="oscar.getElemGroup">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getElemGroup">[docs]</a>
    <span class="k">def</span> <span class="nf">getElemGroup</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the element IDs in an elementset.</span>
<span class="sd">      </span>
<span class="sd">        Args:</span>
<span class="sd">    </span>
<span class="sd">            name:    Name of the elementset. By defauls all element IDs are given.  </span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemCount</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="s1">&#39;elementGroups&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;elementGroups&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">][:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;elementGroups&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">][:]</span>        </div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  elemCount</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
            
<div class="viewcode-block" id="oscar.elemCount">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.elemCount">[docs]</a>
    <span class="k">def</span> <span class="nf">elemCount</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">elemGroup</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      Returns the number of elements in this data set (in this cycle).</span>
<span class="sd">      </span>
<span class="sd">      Args:</span>
<span class="sd">        elemGroup:  specify an element group. In that case it returns the </span>
<span class="sd">                    number of elements in that group.      </span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="n">elemGroup</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemNodes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getElemGroup</span><span class="p">(</span><span class="n">elemGroup</span><span class="p">))</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.getElemIndex">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getElemIndex">[docs]</a>
    <span class="k">def</span> <span class="nf">getElemIndex</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">elemID</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">   </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">          Return element Index</span>
<span class="sd">      </span>
<span class="sd">          Args:</span>
<span class="sd">            elemID:   integer or list of elementIDs</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="s1">&#39;elements&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>    
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">]</span>
            
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="s1">&#39;elementIDs&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elemID</span><span class="p">)</span>      </div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="oscar.getElemIDs">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getElemIDs">[docs]</a>
    <span class="k">def</span> <span class="nf">getElemIDs</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">   </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">          Return element IDs in the set.</span>
<span class="sd">        &#39;&#39;&#39;</span>
 
        <span class="k">if</span> <span class="s1">&#39;elements&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>        
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;elements&#39;</span><span class="p">]</span>
                        
        <span class="k">return</span> <span class="n">grp</span><span class="p">[</span><span class="s1">&#39;elementIDs&#39;</span><span class="p">][:]</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="oscar.nodeCount">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.nodeCount">[docs]</a>
    <span class="k">def</span> <span class="nf">nodeCount</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">nodeGroup</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the number of nodes in the nodegroup.</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">    </span>
<span class="sd">             nodeGroup:    nodeGroup name. By defaults the total number</span>
<span class="sd">                           of nodes is given.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="n">nodeGroup</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>        
                <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;nodeGroups&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;nodeGroups&#39;</span><span class="p">]</span>
            
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="n">nodeGroup</span><span class="p">])</span></div>

            
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="oscar.unpackElements">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.unpackElements">[docs]</a>
    <span class="k">def</span> <span class="nf">unpackElements</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">a</span> <span class="p">:</span> <span class="nb">list</span> <span class="p">,</span> <span class="n">offsets</span> <span class="p">:</span> <span class="nb">list</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
             
        <span class="n">elemNodes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
        
        <span class="n">elemNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">offsets</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">elemNodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
            
        <span class="k">return</span> <span class="n">elemNodes</span></div>

      
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.getNodeIndex">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getNodeIndex">[docs]</a>
    <span class="k">def</span> <span class="nf">getNodeIndex</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">nodeID</span> <span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">   </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the index of nodeID. This is the index of the node in the input file.</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">    </span>
<span class="sd">            nodeID:   The nodeID. This can be an integer or a list.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>                           
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span> 
                                   
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="s1">&#39;nodeIDs&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">nodeID</span><span class="p">)</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="oscar.getNodeIDs">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getNodeIDs">[docs]</a>
    <span class="k">def</span> <span class="nf">getNodeIDs</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">   </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a list of all the nodeIDs.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>                           
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span>                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;nodes&#39;</span><span class="p">]</span>
            
        <span class="k">return</span> <span class="n">grp</span><span class="p">[</span><span class="s1">&#39;nodeIDs&#39;</span><span class="p">][:]</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.getNodeGroupNames">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getNodeGroupNames">[docs]</a>
    <span class="k">def</span> <span class="nf">getNodeGroupNames</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the names of all NodeGroups in this data set.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>                           
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;nodeGroups&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;nodeGroups&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="oscar.getNodeGroup">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getNodeGroup">[docs]</a>
    <span class="k">def</span> <span class="nf">getNodeGroup</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the nodeID that are present in a certain NodeGroup.</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">      </span>
<span class="sd">            name:    Name of the nodegroup.       </span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;nodes&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>                               
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;nodeGroups&#39;</span><span class="p">]</span>        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;nodeGroups&#39;</span><span class="p">]</span>
            
        <span class="k">return</span> <span class="n">grp</span><span class="p">[</span><span class="n">name</span><span class="p">][:]</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
                         
<div class="viewcode-block" id="oscar.rank">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.rank">[docs]</a>
    <span class="k">def</span> <span class="nf">rank</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the rank of the problem. This is the number of spatial</span>
<span class="sd">            dimensions.</span>
<span class="sd">        &#39;&#39;&#39;</span>
  
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>    </div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="oscar.nodeDataSets">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.nodeDataSets">[docs]</a>
    <span class="k">def</span> <span class="nf">nodeDataSets</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns all the labels of node datasets.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;nodeData&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">grp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

    
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="oscar.elemDataSets">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.elemDataSets">[docs]</a>
    <span class="k">def</span> <span class="nf">elemDataSets</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns all the labels of element datasets.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="s1">&#39;elementData&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;elementData&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">grp</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.getDisplacements">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getDisplacements">[docs]</a>
    <span class="k">def</span> <span class="nf">getDisplacements</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">nodeID</span> <span class="p">:</span> <span class="nb">int</span> <span class="p">):</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the displacements of nodes</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">      </span>
<span class="sd">        nodeID:   node number. This can be an integer or a list. </span>
<span class="sd">                    By default the data of all nodes is given as an array.</span>
<span class="sd">        &#39;&#39;&#39;</span>       
    
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeData</span><span class="p">(</span> <span class="s1">&#39;displacements&#39;</span> <span class="p">,</span> <span class="n">nodeID</span> <span class="p">)</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="oscar.getNodeData">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getNodeData">[docs]</a>
    <span class="k">def</span> <span class="nf">getNodeData</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">label</span> <span class="p">:</span> <span class="nb">str</span> <span class="p">,</span> <span class="n">nodeID</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=-</span><span class="mi">1</span> <span class="p">)</span> <span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the node data (label) of nodes nodeID (can be a list or an integer).</span>
<span class="sd">      </span>
<span class="sd">        Args:</span>
<span class="sd">      </span>
<span class="sd">            label:    Name of the node dataset.</span>
<span class="sd">            nodeID:   node number. This can be an integer or a list. </span>
<span class="sd">                      By default the data of all nodes is given as an array.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="n">grp</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;nodeData&#39;</span><span class="p">]</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">grp</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
    
        <span class="k">if</span> <span class="n">nodeID</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">dset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dset</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dset</span><span class="p">[</span><span class="n">nodeID</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dset</span><span class="p">[</span><span class="n">nodeID</span><span class="p">,:]</span></div>

         
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------      </span>

<div class="viewcode-block" id="oscar.getElemData">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getElemData">[docs]</a>
    <span class="k">def</span> <span class="nf">getElemData</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">label</span> <span class="p">:</span> <span class="nb">str</span> <span class="p">,</span> <span class="n">elemID</span> <span class="p">:</span> <span class="nb">int</span><span class="o">=-</span><span class="mi">1</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the element data (label) of elements elemID </span>
<span class="sd">                (can be a list or an integer).</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="n">grp</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;elementData&#39;</span><span class="p">]</span>
        <span class="n">dset</span> <span class="o">=</span> <span class="n">grp</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
    
        <span class="k">if</span> <span class="n">elemID</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dset</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dset</span><span class="p">[</span><span class="n">elemID</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">dset</span><span class="p">[</span><span class="n">elemID</span><span class="p">,:]</span>   </div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------      </span>

<div class="viewcode-block" id="oscar.getMacroFieldData">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.getMacroFieldData">[docs]</a>
    <span class="k">def</span> <span class="nf">getMacroFieldData</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">label</span> <span class="p">:</span><span class="nb">str</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the element data (label) of elements </span>
<span class="sd">            elemID (can be a list or an integer).</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="n">grp</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;macrofield&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">grp</span><span class="p">[</span><span class="n">label</span><span class="p">][:]</span></div>

         
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.particleCount">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.particleCount">[docs]</a>
    <span class="k">def</span> <span class="nf">particleCount</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">particleGroup</span> <span class="p">:</span> <span class="nb">str</span>  <span class="o">=</span> <span class="s1">&#39;all&#39;</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the number of nodes in this set</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="n">particleGroup</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">grp</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;particleGroups&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="n">particleGroup</span><span class="p">])</span>        </div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.saveAsVTU">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.saveAsVTU">[docs]</a>
    <span class="k">def</span> <span class="nf">saveAsVTU</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">prefix</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span> <span class="p">,</span> <span class="n">cycles</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">):</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Saves the data as VTU format</span>
<span class="sd">      </span>
<span class="sd">        Args:</span>
<span class="sd">      </span>
<span class="sd">          prefix: prefix of the pvd and vtu filenames. If omitted the</span>
<span class="sd">                  prefix of the original vtu file is used.</span>
<span class="sd">          cycle:  a list (or integer) of cycles that need</span>
<span class="sd">                  to be written. If omitted, all files will be exported.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
      
        <span class="n">vtufiles</span> <span class="o">=</span> <span class="p">[]</span>
    
        <span class="k">if</span> <span class="n">cycles</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">cycles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cycleCount</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">cycles</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">cycles</span> <span class="o">=</span> <span class="p">[</span><span class="n">cycles</span><span class="p">]</span>  
      
        <span class="k">for</span> <span class="n">iCyc</span> <span class="ow">in</span> <span class="n">cycles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCycle</span><span class="p">(</span> <span class="n">iCyc</span> <span class="p">)</span>

            <span class="n">writer</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkXMLUnstructuredGridWriter</span><span class="p">()</span>
  
            <span class="n">vtufile</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;_t&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iCyc</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.vtu&quot;</span>
            
            <span class="n">writer</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">vtufile</span><span class="p">)</span>
      
            <span class="n">vtufiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vtufile</span><span class="p">)</span>
  
            <span class="n">grid</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkUnstructuredGrid</span><span class="p">()</span>
  
            <span class="c1"># -- Read metadata</span>
    
            <span class="n">points</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPoints</span><span class="p">()</span>
   
            <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoords3</span><span class="p">()</span>
      
            <span class="k">for</span> <span class="n">crd</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
                <span class="n">points</span><span class="o">.</span><span class="n">InsertNextPoint</span><span class="p">(</span><span class="n">crd</span><span class="p">)</span>

            <span class="n">grid</span><span class="o">.</span><span class="n">SetPoints</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>    
    
            <span class="c1">#--Store elements-----------------------------</span>
     
            <span class="k">for</span> <span class="n">elemNodes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemNodes</span><span class="p">:</span>  
                <span class="n">insertElement</span><span class="p">(</span> <span class="n">grid</span> <span class="p">,</span> <span class="n">elemNodes</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
              
            <span class="c1"># -- Write nodedata</span>
  
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeDataSets</span><span class="p">()</span>
      
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>            
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeData</span><span class="p">(</span> <span class="n">label</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;displacements&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">newdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span>
                            <span class="n">newdata</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                            <span class="n">data</span> <span class="o">=</span> <span class="n">newdata</span>
             												
                        <span class="n">d</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkDoubleArray</span><span class="p">();</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span> <span class="n">label</span> <span class="p">);</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">SetNumberOfComponents</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                				
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                                <span class="n">d</span><span class="o">.</span><span class="n">InsertComponent</span><span class="p">(</span> <span class="n">i</span> <span class="p">,</span> <span class="n">j</span> <span class="p">,</span> <span class="n">l</span> <span class="p">)</span>
                				        
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkDoubleArray</span><span class="p">();</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span> <span class="n">label</span> <span class="p">);</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">SetNumberOfComponents</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                    
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">InsertComponent</span><span class="p">(</span> <span class="n">i</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">l</span> <span class="p">)</span>
                        
                <span class="n">grid</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">AddArray</span><span class="p">(</span> <span class="n">d</span> <span class="p">)</span>
        
            <span class="c1"># -- Write elemdata</span>
  
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#self.elemDataSets()</span>
      
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElemData</span><span class="p">(</span> <span class="n">label</span> <span class="p">)</span>
             
                <span class="n">d</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkDoubleArray</span><span class="p">();</span>
                <span class="n">d</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span> <span class="n">label</span> <span class="p">);</span>
                <span class="n">d</span><span class="o">.</span><span class="n">SetNumberOfComponents</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>        
                    <span class="n">d</span><span class="o">.</span><span class="n">InsertComponent</span><span class="p">(</span> <span class="n">i</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">l</span> <span class="p">)</span>
                   
                <span class="n">grid</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span><span class="o">.</span><span class="n">AddArray</span><span class="p">(</span> <span class="n">d</span> <span class="p">)</span>        

            <span class="n">writer</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">Write</span><span class="p">()</span>    
<span class="w">            </span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            if iCyc == 11:</span>
<span class="sd">            </span>
<span class="sd">                # Step 2: Set up a renderer and render window</span>
<span class="sd">                stress_array = grid.GetPointData().GetArray(&quot;S22&quot;)</span>
<span class="sd">                grid.GetPointData().SetScalars(stress_array)</span>

<span class="sd">                # Create a mapper for the mesh</span>
<span class="sd">                mapper = vtk.vtkDataSetMapper()</span>
<span class="sd">                mapper.SetInputData(grid)</span>
<span class="sd">                mapper.SetScalarRange(stress_array.GetRange())  # Set the color range based on the stress data</span>
<span class="sd">                #mapper.SetScalarRange(0,100000000)</span>
<span class="sd">	</span>
<span class="sd">                # Apply a color map (for example, Jet)</span>
<span class="sd">                apply_rainbow_color_map(mapper)</span>

<span class="sd">                # Create an actor for the mesh</span>
<span class="sd">                actor = vtk.vtkActor()</span>
<span class="sd">                actor.SetMapper(mapper)</span>

<span class="sd">                # Create a scalar bar actor for the legend</span>
<span class="sd">                scalar_bar = vtk.vtkScalarBarActor()</span>
<span class="sd">                scalar_bar.SetLookupTable(mapper.GetLookupTable())</span>
<span class="sd">                scalar_bar.SetTitle(&quot;Stress&quot;)</span>
<span class="sd">                scalar_bar.SetNumberOfLabels(4)  # Number of labels on the scalar bar</span>

<span class="sd">                grid.GetPointData().SetVectors(grid.GetPointData().GetArray(&quot;displacements&quot;))</span>
<span class="sd">                </span>
<span class="sd">                warp_vector = vtk.vtkWarpVector()</span>
<span class="sd">                warp_vector.SetInputData(grid)</span>
<span class="sd">                warp_vector.SetScaleFactor(1.0)  # Apply magnification factor</span>

<span class="sd">                # Update the warp vector filter</span>
<span class="sd">                warp_vector.Update()</span>

<span class="sd">                mapper = vtk.vtkDataSetMapper()</span>
<span class="sd">                #mapper.SetInputData(grid)</span>
<span class="sd">                mapper.SetInputConnection(warp_vector.GetOutputPort())</span>

<span class="sd">                actor = vtk.vtkActor()</span>
<span class="sd">                actor.SetMapper(mapper)</span>
<span class="sd">                </span>
<span class="sd">                </span>
<span class="sd">                renderer = vtk.vtkRenderer()</span>
<span class="sd">                renderer.AddActor(actor)</span>
<span class="sd">                renderer.AddActor(scalar_bar)  # Add the scalar bar to the renderer                </span>
<span class="sd">                renderer.SetBackground(1, 1, 1)  # Set background to white</span>

<span class="sd">                render_window = vtk.vtkRenderWindow()</span>
<span class="sd">                render_window.AddRenderer(renderer)</span>
<span class="sd">                render_window.SetSize(800, 800)  # Set the size of the render window</span>

<span class="sd">                </span>
<span class="sd">                renderer.ResetCamera()</span>
<span class="sd">                </span>
<span class="sd">                camera = renderer.GetActiveCamera()</span>
<span class="sd">                camera.Azimuth(245)  # Rotate the camera around the vertical axis</span>
<span class="sd">                camera.Elevation(30)                </span>
<span class="sd">                camera.Zoom(0.5)</span>
<span class="sd">                </span>
<span class="sd">                </span>
<span class="sd">                                </span>
<span class="sd">                window_to_image_filter = vtk.vtkWindowToImageFilter()</span>
<span class="sd">                window_to_image_filter.SetInput(render_window)</span>
<span class="sd">                window_to_image_filter.Update()</span>
<span class="sd">                </span>
<span class="sd">                # Step 6: Save the image as a PNG file</span>
<span class="sd">                writer2 = vtk.vtkPNGWriter()</span>
<span class="sd">                writer2.SetFileName(&quot;output_image.png&quot;)</span>
<span class="sd">                writer2.SetInputData(window_to_image_filter.GetOutput())</span>
<span class="sd">                writer2.Write()</span>
<span class="sd">                &#39;&#39;&#39;</span>
                                 
        <span class="n">writePVD</span><span class="p">(</span> <span class="n">prefix</span> <span class="p">,</span> <span class="n">cycles</span> <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">cycles</span></div>


<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#  saveAsDat</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
    
<div class="viewcode-block" id="oscar.saveAsDat">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.saveAsDat">[docs]</a>
    <span class="k">def</span> <span class="nf">saveAsDat</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">fileName</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span> <span class="p">,</span> <span class="n">cycle</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">,</span> <span class="n">output</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dawn&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      Saves the data as dawn data format</span>
<span class="sd">      </span>
<span class="sd">      Args:</span>
<span class="sd">      </span>
<span class="sd">        fileName:  output filename. If not ending by .dat, it will be added.</span>
<span class="sd">        cycle:     cycle number.</span>
<span class="sd">        output:    ouput type.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="n">fileName</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;.dat&#39;</span>
        
        <span class="n">deformed</span> <span class="o">=</span> <span class="kc">True</span>    
        
        <span class="k">if</span> <span class="n">cycle</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">deformed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="mi">1</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">setCycle</span><span class="p">(</span> <span class="n">cycle</span> <span class="p">)</span>

        <span class="n">datFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
       
        <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span>
    
        <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;Nodes&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">deformed</span><span class="p">:</span>
            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">coordinates</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeData</span><span class="p">(</span> <span class="s2">&quot;displacements&quot;</span> <span class="p">)</span>
               
        <span class="k">for</span> <span class="n">nodeID</span><span class="p">,</span><span class="n">crd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coordinates</span><span class="p">):</span>
            <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">nodeID</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">crd</span><span class="p">:</span>
                <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%e</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">x</span> <span class="p">)</span>
            <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; ;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
      
        <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/Nodes&gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>      
           
        <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;Elements&gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;dawn&#39;</span><span class="p">:</span>       
            <span class="k">for</span> <span class="n">elemID</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemCount</span><span class="p">()):</span>     
                <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">elemID</span> <span class="p">)</span>
                <span class="n">elemNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElemNodes</span><span class="p">(</span><span class="n">elemID</span><span class="p">)</span>
      
            <span class="k">for</span> <span class="n">iNod</span> <span class="ow">in</span> <span class="n">elemNodes</span><span class="p">:</span>
                <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">iNod</span> <span class="p">)</span>
            <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; ;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>       
    
        <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;pyfem&#39;</span><span class="p">:</span>    
            <span class="n">elemGroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElemGroupNames</span><span class="p">()</span>
  
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
      
        <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">elemGroups</span><span class="p">:</span>
            <span class="n">elemIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElemGroup</span><span class="p">(</span> <span class="n">grp</span> <span class="p">)</span>      
            <span class="k">for</span> <span class="n">elemID</span> <span class="ow">in</span> <span class="n">elemIDs</span><span class="p">:</span>
                <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">grp</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">elemNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElemNodes</span><span class="p">(</span><span class="n">elemID</span><span class="p">)</span>
      
            <span class="k">for</span> <span class="n">iNod</span> <span class="ow">in</span> <span class="n">elemNodes</span><span class="p">:</span>
                <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">iNod</span> <span class="p">)</span>
                <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; ;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>      
          
                <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">)</span> 
                  
        <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;/Elements&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>      
        
        <span class="n">nodeGroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeGroupNames</span><span class="p">()</span>
  
        <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">nodeGroups</span><span class="p">:</span>
            <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;NodeGroup name = &#39;</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="se">\n</span><span class="s2">  {&quot;</span> <span class="o">%</span><span class="n">grp</span><span class="p">)</span> 
            <span class="n">nodeIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeGroup</span><span class="p">(</span> <span class="n">grp</span> <span class="p">)</span>
      
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">nodeID</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nodeIDs</span><span class="p">):</span>
                <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">nodeID</span><span class="p">)</span> 
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                 
            <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&lt;/NodeGroup&gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span> 
    
        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;dawn&#39;</span><span class="p">:</span>    
            <span class="n">elemGroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElemGroupNames</span><span class="p">()</span>
  
            <span class="k">for</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">elemGroups</span><span class="p">:</span>
                <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;ElementGroup name = &#39;</span><span class="si">%s</span><span class="s2">&#39;&gt;</span><span class="se">\n</span><span class="s2">  {&quot;</span> <span class="o">%</span><span class="n">grp</span><span class="p">)</span> 
                <span class="n">elemIDs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElemGroup</span><span class="p">(</span> <span class="n">grp</span> <span class="p">)</span>
      
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">elemID</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elemIDs</span><span class="p">):</span>
                    <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">elemID</span><span class="p">)</span> 
                    <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
                <span class="n">datFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&lt;/ElementGroup&gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>       
        
        <span class="n">datFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

  
<span class="c1">#-------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1">#-------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="oscar.saveModes">
<a class="viewcode-back" href="../../oscar.html#oscar.oscar.oscar.saveModes">[docs]</a>
    <span class="k">def</span> <span class="nf">saveModes</span><span class="p">(</span> <span class="bp">self</span> <span class="p">,</span> <span class="n">prefix</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">  </span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Saves the data as VTU format</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
      
        <span class="n">vtufiles</span> <span class="o">=</span> <span class="p">[]</span>
    
        <span class="k">if</span> <span class="n">cycles</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">cycles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cycleCount</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      
        <span class="k">for</span> <span class="n">iMod</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>

            <span class="n">writer</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkXMLUnstructuredGridWriter</span><span class="p">()</span>
  
            <span class="n">vtufile</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iMod</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.vtu&quot;</span>
      
            <span class="n">writer</span><span class="o">.</span><span class="n">SetFileName</span><span class="p">(</span><span class="n">vtufile</span><span class="p">)</span>
      
            <span class="n">vtufiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vtufile</span><span class="p">)</span>
  
            <span class="n">grid</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkUnstructuredGrid</span><span class="p">()</span>
  
            <span class="c1"># -- Read metadata</span>
    
            <span class="n">points</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkPoints</span><span class="p">()</span>
   
            <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCoords3</span><span class="p">()</span>
      
            <span class="k">for</span> <span class="n">crd</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
                <span class="n">points</span><span class="o">.</span><span class="n">InsertNextPoint</span><span class="p">(</span><span class="n">crd</span><span class="p">)</span>

            <span class="n">grid</span><span class="o">.</span><span class="n">SetPoints</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>    
    
            <span class="c1">#--Store elements-----------------------------</span>
     
            <span class="k">for</span> <span class="n">iElm</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elemCount</span><span class="p">()):</span>        
                <span class="n">insertElement</span><span class="p">(</span> <span class="n">grid</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElemNodes</span><span class="p">(</span><span class="n">iElm</span><span class="p">)</span> <span class="p">,</span> <span class="mi">3</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
              
            <span class="c1"># -- Write nodedata</span>
   
           
        <span class="n">pvdfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s2">&quot;.pvd&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;VTKFile byte_order=&#39;LittleEndian&#39; &quot;</span><span class="p">)</span>
        <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;type=&#39;Collection&#39; version=&#39;0.1&#39;&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">pvdfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  &lt;Collection&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>                      </div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Joris Remmers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>